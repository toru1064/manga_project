<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <title>æ¼«ç”»æ„Ÿæƒ³ã‚¢ãƒ—ãƒª</title>
    </head>
    <body>
        <p>
            <a href="{{ url_for('main.logout') }}">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
        </p>

        <h1>æ¼«ç”»ã®æ„Ÿæƒ³ã‚’æŠ•ç¨¿</h1>

        <h2>æ¼«ç”»ã‚’æ¤œç´¢</h2>
        <form method="GET" action="{{ url_for('main.index') }}">
            <input type="text" name="keyword" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" value="{{ request.args.get('keyword', '') }}">
            <input type="submit" value="æ¤œç´¢">
        </form>
        <hr>

        {% if error %}
            <p style="color: red;">{{error}}</p>
        {% endif %}

        <form method="POST">
            <p>ã‚¿ã‚¤ãƒˆãƒ«:<input type="text" name="title" value="{{ input_title }}" required></p>
            <p>æ„Ÿæƒ³:<textarea name="review" required>{{ input_review }}</textarea></p>
            <p>è©•ä¾¡(1~5):<input type="number" name="rating" min="1" max="5" value="{{ input_rating }}" required></p>
            <p><input type="submit" value="æŠ•ç¨¿"></p>
        </form>

        <hr>

        <h2>æŠ•ç¨¿ä¸€è¦§</h2>
        <form method="GET" action="/" style="display: inline;">
            <input type="hidden" name="filter" value="my_posts">
            <button type="submit">è‡ªåˆ†ã®æŠ•ç¨¿ã ã‘è¡¨ç¤º</button>
        </form>

        <p><a href="/">ã™ã¹ã¦ã®æŠ•ç¨¿ã‚’è¡¨ç¤º</a></p>   
        {% for post in posts %}
            <p>æŠ•ç¨¿æ—¥æ™‚: {{ post.created_at.strftime('%Y/%m/%d %H:%M') }}</p>
            <p>æŠ•ç¨¿è€…ï¼š {{ post.user.username }}</p>
            <p>ã‚¿ã‚¤ãƒˆãƒ«: {{ post.title }}</p>
            <p>æ„Ÿæƒ³: {{ post.review }}</p>
            <p>è©•ä¾¡: {{ post.rating }} / 5</p>

            <form method="POST" action="{{ url_for('main.toggle_like', book_id=post.id) }}" style="display: inline;">
                <button type="submit">
                    {% if current_user in post.liked_users %}
                        â¤ï¸ {{ post.likes.count() }} ã„ã„ã­è§£é™¤
                    {% else %}
                        ğŸ¤ {{ post.likes.count() }} ã„ã„ã­
                    {% endif %}
                </button>
            </form>

            <!-- ç·¨é›†ãƒ»å‰Šé™¤ã¯è‡ªåˆ†ã®æŠ•ç¨¿ã ã‘ -->
            {% if post.user_id == current_user.id %}
                <form method="POST" action="{{ url_for('main.delete', id=post.id) }}" style="display: inline;">
                    <button type="submit">å‰Šé™¤</button>
                </form>
                <form method="GET" action="{{ url_for('main.edit', id=post.id) }}" style="display: inline;">
                    <button type="submit">ç·¨é›†</button>
                </form>
            {% endif %}
            <hr>

        {% endfor %}
    </body>
</html>